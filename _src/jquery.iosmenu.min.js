/*
 * iosMenu - http://iosscripts.com/iosmenu/
 * 
 * Touch Enabled, Responsive jQuery Flyout Navigation Menu/Hidden Side Panel Plugin
 *
 * iosmenu is a jQuery plugin which allows you to integrate a customizable, cross-browser 
 * fly-out navigation menu into your mobile web presence. Designed for use as a native app 
 * style fly-out menu or hidden side content panel.
 * 
 * Copyright (c) 2013 Marc Whitbread
 * 
 * Version: v0.5.0 (04/27/2014)
 * Minimum requirements: jQuery v1.4+
 *
 * Advanced requirements:
 * 1) jQuery bind() click event override on slide requires jQuery v1.6+
 *
 * Terms of use:
 *
 * 1) iosMenu is licensed under the Creative Commons â€“ Attribution-NonCommercial 3.0 License.
 * 2) You may use iosSlider free for personal or non-profit purposes, without restriction.
 *	  Attribution is not required but always appreciated. For commercial projects, you
 *	  must purchase a license. You may download and play with the script before deciding to
 *	  fully implement it in your project. Making sure you are satisfied, and knowing iosSlider
 *	  is the right script for your project is paramount.
 * 3) You are not permitted to make the resources found on iosscripts.com available for
 *    distribution elsewhere "as is" without prior consent. If you would like to feature
 *    iosSlider on your site, please do not link directly to the resource zip files. Please
 *    link to the appropriate page on iosscripts.com where users can find the download.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
 * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDI_liNG, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE
 * GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED
 * AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED
 * OF THE POSSIBILITY OF SUCH DAMAGE.
 */

(function(d){var w="onorientationchange"in window,t="",s=!1,q=!1,u=!1,l=0,v=-1,x={obj:"",bg_obj:"",menu_number:0,resp:{menu_w:0,menu_outer_w:0,menu_h:0,offset_left_op:0,offset_left_cl:0,offset_left_mi:0,pull_threshold_px:0,pull_threshold:0},touch:{pull_threshold_perc:0.1,pull_threshold_max_px:50,pull_threshold_min_px:20,snap_threshold:2,start_threshold:0,v_pull_threshold:3,h_pull_threshold:3},anim:{fps:6E4,duration:750,menu_timeouts:[]},state:{open:!0,flags:{pull_threshold:!1,event_start:!1,mouse_down:!1}, callback_fired:{start:!1,middle_open:!1,middle_close:!0,complete:!1}},body_css:{position:"relative"},menu_css:{position:"fixed",top:0,left:0,bottom:0,overflow:"auto",zIndex:1E3,display:"block",opacity:1},bg_css:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"#000",opacity:0.75,zIndex:999},menu_location:"right",parallax_ratio:1,menu_toggle_button_selector:"",move_with_menu_selector:"",on_loaded:"",on_resize:"",on_update:"",on_start:"",on_middle:"",on_complete:"",on_step:""},c={init_globals:function(){t= w?"orientationchange":"resize";c.has_3d_transform()},init_settings:function(a){v++;a=d.extend(!0,x,a);a.menu_number=v;return a},init_css:function(a){d(a.obj).css(a.menu_css).css({opacity:0,zIndex:-1E3,display:"none"});var c=d("<div />",{"class":"iosmenu-bg-"+a.menu_number}).css(a.bg_css).css({opacity:0,zIndex:999,display:"none"});a.bg_obj=c;d("body").append(c).css(a.body_css);return a},set_resp_settings:function(a){l=d(window).width();d(window).height();d(a.obj).css("width","");a.resp.menu_w=d(a.obj).width(); a.resp.menu_outer_w=d(a.obj).outerWidth(!0);a.resp.menu_h=d(a.obj).height();a.resp.offset_left_op="left"==a.menu_location?a.resp.menu_outer_w:-a.resp.menu_outer_w;a.resp.offset_left_cl=0;a.resp.offset_left_mi="left"==a.menu_location?0.5*a.resp.menu_outer_w:-0.5*a.resp.menu_outer_w;a.resp.pull_threshold_px=parseInt(l*a.touch.pull_threshold_perc,10);a.resp.pull_threshold_px<a.touch.pull_threshold_min_px?a.resp.pull_threshold_px=a.touch.pull_threshold_min_px:a.resp.pull_threshold_px>a.touch.pull_threshold_max_px&& (a.resp.pull_threshold_px=a.touch.pull_threshold_max_px);a.resp.pull_threshold="left"==a.menu_location?a.resp.pull_threshold_px:l-a.resp.pull_threshold_px;return a},set_resp_css:function(a){d(a.obj).css(a.menu_css).css({width:a.resp.menu_w+"px"});c.set_position(a,a.state.open?a.resp.offset_left_op:a.resp.offset_left_cl)},set_browser_info:function(){null==navigator.userAgent.match("WebKit")&&null==navigator.userAgent.match("Gecko")&&(null!=navigator.userAgent.match("MSIE 7")?s=!0:null!=navigator.userAgent.match("MSIE 8")? q=!0:navigator.userAgent.match("MSIE 9"));navigator.userAgent.match(/(iPad|iPhone);.*CPU.*OS 7_\d/i)},has_3d_transform:function(){var a=!1,c=d("<div />").css({webkitTransform:"matrix(1,1,1,1,1,1)",MozTransform:"matrix(1,1,1,1,1,1)",transform:"matrix(1,1,1,1,1,1)"});""==c.attr("style")?a=!1:void 0!=c.attr("style")&&(a=!0);u=a},update_data:function(a){d(a.obj).data("iosmenu",{settings:a})},get_position:function(a){var c=0;return c=parseInt(d("body").css("left"),10)/a.parallax_ratio},set_position:function(a, c){var b=c==a.resp.offset_left_cl?0:1,e=c==a.resp.offset_left_cl?"none":"block",k=(c-a.resp.offset_left_op)/(a.resp.offset_left_cl-a.resp.offset_left_op)*-a.bg_css.opacity+a.bg_css.opacity,g="left"==a.menu_location?c-a.resp.menu_w:l+c,f=c;c*=a.parallax_ratio;u?(d(a.obj).css({webkitTransform:"matrix(1,0,0,1,"+g+",0)",MozTransform:"matrix(1,0,0,1,"+g+",0)",transform:"matrix(1,0,0,1,"+g+",0)"}),d(a.move_with_menu_selector).css({webkitTransform:"matrix(1,0,0,1,"+f+",0)",MozTransform:"matrix(1,0,0,1,"+ f+",0)",transform:"matrix(1,0,0,1,"+f+",0)"})):(d(a.obj).css("left",g+"px"),d(a.move_with_menu_selector).css("left",f+"px"));d("body").css({left:c+"px"});d(a.obj).css({opacity:b});a.bg_obj.css({opacity:k,display:e})},snap_direction:function(a,d){var b=0;d.distance>a.touch.snap_threshold?b=1:d.distance<-1*a.touch.snap_threshold&&(b=-1);0==b&&c.get_position(a)<=a.resp.offset_left_mi?b=1:0==b&&c.get_position(a)>a.resp.offset_left_mi&&(b=-1);"left"==a.menu_location&&(b=-b);return b},animate_menu:function(a, d){var b=a.anim.fps/a.anim.duration,e=a.anim.duration/b,k=c.get_position(a),g=1==d?a.resp.offset_left_op:a.resp.offset_left_cl;c.animate_menu_timer_clear(a);for(var f=1;f<=b;f++){var h=f,h=h/b;h--;h=Math.pow(h,5)+1;h=Math.round(k-(k-g)*h);a=c.animate_menu_timer(f*e,h,!1,a);if(h==g)break}return a=c.animate_menu_timer((f+1)*e,g,!0,a)},animate_menu_timer:function(a,d,b,e){e.anim.menu_timeouts[e.anim.menu_timeouts.length]=setTimeout(function(){e=c.animate_menu_step(d,b,e)},a);return e},animate_menu_step:function(a, d,b){b.state.open=a==b.resp.offset_left_cl?!1:!0;c.set_position(b,a);b=c.callback.start(b);b=c.callback.step(b);b=c.callback.middle(b);d&&c.callback.complete(b);return b},animate_menu_timer_clear:function(a){for(var c=0;c<a.anim.menu_timeouts.length;c++)clearTimeout(a.anim.menu_timeouts[c]),a.anim.menu_timeouts[c]=void 0},deselect_elements:function(){if(window.getSelection)window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges(); else if(document.selection)if(q)try{document.selection.empty()}catch(a){}else document.selection.empty()},callback:{args:function(a){return{is_open:a.state.open,is_open_past_mid:a.state.callback_fired.middle_open,perc_open:Math.round(c.get_position(a)/a.resp.offset_left_op*100),settings_raw:a}},reset:function(a){a.state.callback_fired.start=!1;a.state.callback_fired.middle=!1;a.state.callback_fired.complete=!1;return a},loaded:function(a){if(""!=a.on_loaded)a.on_loaded(c.callback.args(a))},resize:function(a){if(""!= a.on_resize)a.on_resize(c.callback.args(a))},update:function(a){if(""!=a.on_update)a.on_update(c.callback.args(a))},start:function(a){a.state.callback_fired.complete=!1;""==a.on_start||a.state.callback_fired.start||(a.state.callback_fired.start=!0,a.on_start(c.callback.args(a)));return a},middle:function(a){var d=c.callback.args(a);if(50<=d.perc_open&&!a.state.callback_fired.middle_open&&(a.state.callback_fired.middle_open=!0,a.state.callback_fired.middle_close=!1,""!=a.on_middle))a.on_middle(c.callback.args(a)); if(50>d.perc_open&&!a.state.callback_fired.middle_close&&(a.state.callback_fired.middle_open=!1,a.state.callback_fired.middle_close=!0,""!=a.on_middle))a.on_middle(c.callback.args(a));return a},complete:function(a){a.state.callback_fired.start=!1;""==a.on_complete||a.state.callback_fired.complete||(a.state.callback_fired.complete=!0,a.on_complete(c.callback.args(a)));return a},step:function(a){if(""!=a.on_step)a.on_step(c.callback.args(a));return a}}};c.set_browser_info();var p={init:function(a,r){void 0== r&&(r=this);if(void 0!=d(r).data("iosmenu"))return!0;c.init_globals();var b=c.init_settings(a);b.obj=d(r).eq(0);b=c.init_css(b);b=c.set_resp_settings(b);c.set_resp_css(b);c.callback.loaded(b);var e={event:0,rate:0,distance:0,direction:0,started:!1,start_position:void 0},k=0,g=0,f=0,h=!1;d(b.menu_toggle_button_selector).css("cursor","pointer");d(b.menu_toggle_button_selector).bind("click",function(a){p.toggle(b.obj)});var m=!1,n=!1;d(window).bind("touchstart.iosmenu-"+b.menu_number+", mousedown.iosmenu-"+ b.menu_number,function(a){if(b.state.flags.event_start)return!0;b.state.flags.event_start=!0;b=c.callback.reset(b);s||q||(a=a.originalEvent);"touchstart"==a.type?(e.event=a.touches[0].pageX,k=a.touches[0].pageY):(e.event=a.pageX,k=a.pageY,b.state.flags.mouse_down=!0);1==d(a.target).closest(".iosmenu").length&&0>=d(a.target).closest(".iosmenu").scrollTop()&&(m=!0);1==d(a.target).closest(".iosmenu").length&&d(a.target).closest(".iosmenu").scrollTop()>=d(a.target).closest(".iosmenu")[0].scrollHeight- b.resp.menu_h&&(n=!0);b.state.flags.pull_threshold=!1;e.rate=[0,0];e.distance=0;e.started=!1;e.start_position=-1*(c.get_position(b)-e.event);e.rate[1]=e.event;g=[0,0];f=0;h=!1;g[1]=k});d(window).bind("touchmove.iosmenu-"+b.menu_number+", mousemove.iosmenu-"+b.menu_number,function(a){s||q||(a=a.originalEvent);if(b.state.flags.pull_threshold)return!0;var l=c.get_position(b);if("touchmove"==a.type)e.event=a.touches[0].pageX,k=a.touches[0].pageY;else{if(!b.state.flags.mouse_down)return!0;e.event=a.pageX; k=a.pageY}e.rate[0]=e.rate[1];e.rate[1]=e.event;e.distance=(e.rate[0]-e.rate[1])/2;g[0]=g[1];g[1]=k;f=(g[0]-g[1])/2;b.state.open&&1!=d(a.target).closest(".iosmenu").length&&a.preventDefault();if((e.event>b.resp.pull_threshold&&"left"==b.menu_location||e.event<b.resp.pull_threshold&&"left"!=b.menu_location)&&!e.started&&!b.state.open)return!0;(f>b.touch.v_pull_threshold||f<-1*b.touch.v_pull_threshold)&&!e.started&&(h=!0);m&&0<f&&(m=!1);n&&0>f&&(n=!1);m&&0>f&&(m=!1,a.preventDefault());n&&0<f&&(n=!1, a.preventDefault());(e.distance<b.touch.h_pull_threshold||e.distance>-1*b.touch.h_pull_threshold)&&1!=d(a.target).closest(".iosmenu").length&&a.preventDefault();!(e.distance<b.touch.start_threshold||e.distance>-1*b.touch.start_threshold)||h||e.started||(e.start_position=-1*(l-e.event),e.started=!0,b=c.callback.start(b));if(!h&&e.started){c.deselect_elements();b.state.open=!0;c.animate_menu_timer_clear(b);a=-1*(e.start_position-e.event);if("left"==b.menu_location&&a>b.resp.offset_left_op||"left"!= b.menu_location&&a<b.resp.offset_left_op)a=b.resp.offset_left_op;if("left"==b.menu_location&&a<b.resp.offset_left_cl||"left"!=b.menu_location&&a>b.resp.offset_left_cl)a=b.resp.offset_left_cl;c.set_position(b,a);b=c.callback.step(b);b=c.callback.middle(b)}});d(window).bind("touchend.iosmenu-"+b.menu_number+", mouseup.iosmenu-"+b.menu_number,function(a){if(b.state.flags.pull_threshold)return!0;("left"==b.menu_location&&e.event>c.get_position(b)||"left"!=b.menu_location&&e.event<c.get_position(b)+l)&& !e.started?e.direction=-1:e.direction=c.snap_direction(b,e);if(e.started||b.state.open)b=c.animate_menu(b,e.direction);c.update_data(b);b.state.flags.event_start=!1;b.state.flags.mouse_down=!1;n=m=e.started=!1});d(window).bind(t+".iosmenu-"+b.menu_number,function(){p.update(b.obj);c.callback.resize(b)});c.update_data(b)},destroy:function(a){a=d(this).data("iosmenu");if(void 0==a)return!1;d(a.settings.obj).removeAttr("style").unbind(".iosmenu, .iosmenu-"+a.settings.menu_number);d("body").removeAttr("style").unbind(".iosmenu, .iosmenu-"+ a.settings.menu_number);d(window).unbind(".iosmenu, .iosmenu-"+a.settings.menu_number);d(a.settings.obj).removeData();d(a.settings.bg_obj).remove()},update:function(a){void 0==a&&(a=this);a=d(a).eq(0);a=d(a).data("iosmenu");if(void 0==a)return!1;settings=c.set_resp_settings(a.settings);c.set_resp_css(settings);c.callback.update(settings)},toggle:function(a){void 0==a&&(a=this);a=d(a).eq(0);a=d(a).data("iosmenu");if(void 0==a)return!1;c.animate_menu(a.settings,a.settings.state.open?-1:1)},open:function(a){void 0== a&&(a=this);a=d(a).eq(0);a=d(a).data("iosmenu");if(void 0==a)return!1;c.animate_menu(a.settings,1)},close:function(a){void 0==a&&(a=this);a=d(a).eq(0);a=d(a).data("iosmenu");if(void 0==a)return!1;c.animate_menu(a.settings,-1)}};d.fn.iosMenu=function(a){if(p[a])return p[a].apply(this,Array.prototype.slice.call(arguments,1));if("object"!==typeof a&&a)d.error("invalid method call!");else return p.init.apply(this,arguments)}})(jQuery);